var __awaiter=this&&this.__awaiter||function(e,t,n,r){function s(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r["throw"](e))}catch(e){o(e)}}function c(e){e.done?n(e.value):s(e.value).then(i,a)}c((r=r.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,s,o,i;return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(i){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,s&&(o=i[0]&2?s["return"]:i[0]?s["throw"]||((o=s["return"])&&o.call(s),0):s.next)&&!(o=o.call(s,i[1])).done)return o;if(s=0,o)i=[i[0]&2,o.value];switch(i[0]){case 0:case 1:o=i;break;case 4:n.label++;return{value:i[1],done:false};case 5:n.label++;s=i[1];i=[0];continue;case 7:i=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(i[0]===6||i[0]===2)){n=0;continue}if(i[0]===3&&(!o||i[1]>o[0]&&i[1]<o[3])){n.label=i[1];break}if(i[0]===6&&n.label<o[1]){n.label=o[1];o=i;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(i);break}if(o[2])n.ops.pop();n.trys.pop();continue}i=t.call(e,n)}catch(e){i=[6,e];s=0}finally{r=o=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),s=0,t=0;t<n;t++)for(var o=arguments[t],i=0,a=o.length;i<a;i++,s++)r[s]=o[i];return r};System.register(["./index-96abf35d.system.js","./index-03104e92.system.js","./leaflet-src-5e3930c1.system.js"],(function(e){"use strict";var t,n,r,s,o,i;return{setters:[function(e){t=e.r;n=e.h;r=e.H},function(e){s=e.s;o=e.r},function(e){i=e.l}],execute:function(){function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function l(e,t,n,r){void 0===t&&(t=""),void 0===r&&(r={});var s=document.createElement(e);return t&&(s.className=t),Object.keys(r).forEach((function(e){if("function"==typeof r[e]){var t=0===e.indexOf("on")?e.substr(2).toLowerCase():e;s.addEventListener(t,r[e])}else"html"===e?s.innerHTML=r[e]:"text"===e?s.innerText=r[e]:s.setAttribute(e,r[e])})),n&&n.appendChild(s),s}function u(e){e.preventDefault(),e.stopPropagation()}var h=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ").trim()};function d(e,t){e&&e.classList&&(Array.isArray(t)?t:[t]).forEach((function(t){e.classList.contains(t)||e.classList.add(t)}))}function p(e,t){e&&e.classList&&(Array.isArray(t)?t:[t]).forEach((function(t){e.classList.contains(t)&&e.classList.remove(t)}))}var f,m=13,v=40,y=38,g=[m,27,v,y,37,39],b=function(){function e(e){var t=this,n=e.handleSubmit,r=e.searchLabel,s=e.classNames,o=void 0===s?{}:s;this.hasError=!1,this.container=l("div",h("geosearch",o.container)),this.form=l("form",["",o.form].join(" "),this.container,{autocomplete:"none",onClick:u,onDblClick:u,touchStart:u,touchEnd:u}),this.input=l("input",["glass",o.input].join(" "),this.form,{type:"text",placeholder:r||"search",onInput:this.onInput,onKeyUp:function(e){return t.onKeyUp(e)},onKeyPress:function(e){return t.onKeyPress(e)},onFocus:this.onFocus,onBlur:this.onBlur,onClick:function(){t.input.focus(),t.input.dispatchEvent(new Event("focus"))}}),this.handleSubmit=n}var t=e.prototype;return t.onFocus=function(){d(this.form,"active")},t.onBlur=function(){p(this.form,"active")},t.onSubmit=function(e){try{var t=this;return u(e),p(n=t.container,"error"),d(n,"pending"),Promise.resolve(t.handleSubmit({query:t.input.value})).then((function(){p(t.container,"pending")}))}catch(e){return Promise.reject(e)}var n},t.onInput=function(){this.hasError&&(p(this.container,"error"),this.hasError=!1)},t.onKeyUp=function(e){27===e.keyCode&&(p(this.container,["pending","active"]),this.input.value="",document.body.focus(),document.body.blur())},t.onKeyPress=function(e){e.keyCode===m&&this.onSubmit(e)},t.setQuery=function(e){this.input.value=e},e}(),k=function(){function e(e){var t=this,n=e.handleClick,r=e.classNames,s=void 0===r?{}:r;this.selected=-1,this.results=[],this.onClick=function(e){if("function"==typeof t.handleClick){var n=e.target;if(n&&t.container.contains(n)&&n.hasAttribute("data-key")){var r=Number(n.getAttribute("data-key"));t.clear(),t.handleClick({result:t.results[r]})}}},this.handleClick=n,this.container=l("div",h("results",s.container)),this.container.addEventListener("click",this.onClick,!0),this.resultItem=l("div",h(s.item))}var t=e.prototype;return t.render=function(e){var t=this;void 0===e&&(e=[]),this.clear(),e.forEach((function(e,n){var r=t.resultItem.cloneNode(!0);r.setAttribute("data-key",""+n),r.innerHTML=e.label,t.container.appendChild(r)})),e.length>0&&(d(this.container.parentElement,"open"),d(this.container,"active")),this.results=e},t.select=function(e){return Array.from(this.container.children).forEach((function(t,n){return n===e?d(t,"active"):p(t,"active")})),this.selected=e,this.results[e]},t.count=function(){return this.results?this.results.length:0},t.clear=function(){for(this.selected=-1;this.container.lastChild;)this.container.removeChild(this.container.lastChild);p(this.container.parentElement,"open"),p(this.container,"active")},e}(),w={position:"topleft",style:"button",showMarker:!0,showPopup:!1,popupFormat:function(e){return""+e.result.label},marker:{icon:i&&i.Icon?new i.Icon.Default:void 0,draggable:!1},maxMarkers:1,maxSuggestions:5,retainZoomLevel:!1,animateZoom:!0,searchLabel:"Enter address",notFoundMessage:"Sorry, that address could not be found.",messageHideDelay:3e3,zoomLevel:18,classNames:{container:"leaflet-bar leaflet-control leaflet-control-geosearch",button:"leaflet-bar-part leaflet-bar-part-single",resetButton:"reset",msgbox:"leaflet-bar message",form:"",input:""},autoComplete:!0,autoCompleteDelay:250,autoClose:!1,keepResult:!1,updateMap:!0},x="Leaflet must be loaded before instantiating the GeoSearch control",E={options:a({},w),classNames:a({},w.classNames),initialize:function(e){var t,n,r,s,o=this;if(!i)throw new Error(x);if(!e.provider)throw new Error("Provider is missing from options");this.options=a({},this.options,{},e),this.classNames=a({},this.classNames,{},e.classNames),this.markers=new i.FeatureGroup,this.classNames.container+=" leaflet-geosearch-"+this.options.style,this.searchElement=new b({searchLabel:this.options.searchLabel,classNames:{container:this.classNames.container,form:this.classNames.form,input:this.classNames.input},handleSubmit:function(e){return o.onSubmit(e)}}),this.button=l("a",this.classNames.button,this.searchElement.container,{title:this.options.searchLabel,href:"#",onClick:function(e){return o.onClick(e)}}),i.DomEvent.disableClickPropagation(this.button),this.resetButton=l("a",this.classNames.resetButton,this.searchElement.form,{text:"Ã—",href:"#",onClick:function(){return o.clearResults(null,!0)}}),i.DomEvent.disableClickPropagation(this.resetButton),this.options.autoComplete&&(this.resultList=new k({handleClick:function(e){var t=e.result;o.searchElement.input.value=t.label,o.onSubmit({query:t.label,data:t})}}),this.searchElement.form.appendChild(this.resultList.container),this.searchElement.input.addEventListener("keyup",(t=function(e){return o.autoSearch(e)},void 0===(n=this.options.autoCompleteDelay)&&(n=250),void 0===r&&(r=!1),function(){for(var e=arguments.length,o=new Array(e),i=0;i<e;i++)o[i]=arguments[i];s&&clearTimeout(s),s=setTimeout((function(){s=null,r||t.apply(void 0,o)}),n),r&&!s&&t.apply(void 0,o)}),!0),this.searchElement.input.addEventListener("keydown",(function(e){return o.selectResult(e)}),!0),this.searchElement.input.addEventListener("keydown",(function(e){return o.clearResults(e,!0)}),!0)),this.searchElement.form.addEventListener("click",(function(e){e.preventDefault()}),!1)},onAdd:function(e){var t=this.options,n=t.showMarker,r=t.style;if(this.map=e,n&&this.markers.addTo(e),"bar"===r){var s=e.getContainer().querySelector(".leaflet-control-container");this.container=l("div","leaflet-control-geosearch leaflet-geosearch-bar"),this.container.appendChild(this.searchElement.form),s.appendChild(this.container)}return i.DomEvent.disableClickPropagation(this.searchElement.form),this.searchElement.container},onRemove:function(){var e;return null==(e=this.container)||e.remove(),this},onClick:function(e){e.preventDefault(),e.stopPropagation();var t=this.searchElement,n=t.container,r=t.input;n.classList.contains("active")?(p(n,"active"),this.clearResults()):(d(n,"active"),r.focus())},selectResult:function(e){if(-1!==[m,v,y].indexOf(e.keyCode))if(e.preventDefault(),e.keyCode!==m){var t=this.resultList.count()-1;if(!(t<0)){var n=this.resultList.selected,r=e.keyCode===v?n+1:n-1,s=this.resultList.select(r<0?t:r>t?0:r);this.searchElement.input.value=s.label}}else{var o=this.resultList.select(this.resultList.selected);this.onSubmit({query:this.searchElement.input.value,data:o})}},clearResults:function(e,t){if(void 0===t&&(t=!1),!e||27===e.keyCode){var n=this.options,r=n.autoComplete;!t&&n.keepResult||(this.searchElement.input.value="",this.markers.clearLayers()),r&&this.resultList.clear()}},autoSearch:function(e){try{var t=this;if(g.indexOf(e.keyCode)>-1)return Promise.resolve();var n=e.target.value,r=t.options.provider,s=function(){if(n.length)return Promise.resolve(r.search({query:n})).then((function(e){e=e.slice(0,t.options.maxSuggestions),t.resultList.render(e)}));t.resultList.clear()}();return Promise.resolve(s&&s.then?s.then((function(){})):void 0)}catch(e){return Promise.reject(e)}},onSubmit:function(e){try{var t=this;return Promise.resolve(t.options.provider.search(e)).then((function(n){n&&n.length>0&&t.showResult(n[0],e)}))}catch(e){return Promise.reject(e)}},showResult:function(e,t){var n=this.options,r=n.autoClose,s=n.updateMap,o=this.markers.getLayers();o.length>=this.options.maxMarkers&&this.markers.removeLayer(o[0]);var i=this.addMarker(e,t);s&&this.centerMap(e),this.map.fireEvent("geosearch/showlocation",{location:e,marker:i}),r&&this.closeResults()},closeResults:function(){var e=this.searchElement.container;e.classList.contains("active")&&p(e,"active"),this.clearResults()},addMarker:function(e,t){var n=this,r=this.options,s=r.marker,o=r.showPopup,a=r.popupFormat,c=new i.Marker([e.y,e.x],s),l=e.label;return"function"==typeof a&&(l=a({query:t,result:e})),c.bindPopup(l),this.markers.addLayer(c),o&&c.openPopup(),s.draggable&&c.on("dragend",(function(e){n.map.fireEvent("geosearch/marker/dragend",{location:c.getLatLng(),event:e})})),c},centerMap:function(e){var t=this.options,n=t.retainZoomLevel,r=t.animateZoom,s=e.bounds?new i.LatLngBounds(e.bounds):new i.LatLng(e.y,e.x).toBounds(10),o=s.isValid()?s:this.markers.getBounds();!n&&s.isValid()?this.map.fitBounds(o,{animate:r}):this.map.setView(o.getCenter(),this.getZoom(),{animate:r})},getZoom:function(){var e=this.options,t=e.zoomLevel;return e.retainZoomLevel?this.map.getZoom():t}};!function(e){e[e.SEARCH=0]="SEARCH",e[e.REVERSE=1]="REVERSE"}(f||(f={}));var L=function(){function e(e){void 0===e&&(e={}),this.options=e}var t=e.prototype;return t.getParamString=function(e){void 0===e&&(e={});var t=a({},this.options.params,{},e);return Object.keys(t).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])})).join("&")},t.getUrl=function(e,t){return e+"?"+this.getParamString(t)},t.search=function(e){try{var t=this,n=t.endpoint({query:e.query,type:f.SEARCH});return Promise.resolve(fetch(n)).then((function(e){return Promise.resolve(e.json()).then((function(e){return t.parse({data:e})}))}))}catch(e){return Promise.reject(e)}},e}(),C=function(e){function t(){return e.apply(this,arguments)||this}c(t,e);var n=t.prototype;return n.endpoint=function(){return"https://places-dsn.algolia.net/1/places/query"},n.findBestMatchLevelIndex=function(e){var t=e.find((function(e){return"full"===e.matchLevel}))||e.find((function(e){return"partial"===e.matchLevel}));return t?e.indexOf(t):0},n.getLabel=function(e){var t,n,r,s;return[null==(t=e.locale_names)?void 0:t.default[this.findBestMatchLevelIndex(e._highlightResult.locale_names.default)],null==(n=e.city)?void 0:n.default[this.findBestMatchLevelIndex(e._highlightResult.city.default)],e.administrative[this.findBestMatchLevelIndex(e._highlightResult.administrative)],null==(r=e.postcode)?void 0:r[this.findBestMatchLevelIndex(e._highlightResult.postcode)],null==(s=e.country)?void 0:s.default].filter(Boolean).join(", ")},n.parse=function(e){var t=this;return e.data.hits.map((function(e){return{x:e._geoloc.lng,y:e._geoloc.lat,label:t.getLabel(e),bounds:null,raw:e}}))},n.search=function(e){var t=e.query;try{var n=this,r="string"==typeof t?{query:t}:t;return Promise.resolve(fetch(n.endpoint(),{method:"POST",body:JSON.stringify(a({},n.options.params,{},r))})).then((function(e){return Promise.resolve(e.json()).then((function(e){return n.parse({data:e})}))}))}catch(e){return Promise.reject(e)}},t}(L),S=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).searchUrl="https://dev.virtualearth.net/REST/v1/Locations",t}c(t,e);var n=t.prototype;return n.endpoint=function(e){var t=e.query,n="string"==typeof t?{q:t}:t;return n.jsonp=e.jsonp,this.getUrl(this.searchUrl,n)},n.parse=function(e){return 0===e.data.resourceSets.length?[]:e.data.resourceSets[0].resources.map((function(e){return{x:e.point.coordinates[1],y:e.point.coordinates[0],label:e.address.formattedAddress,bounds:[[e.bbox[0],e.bbox[1]],[e.bbox[2],e.bbox[3]]],raw:e}}))},n.search=function(e){var t,n,r,s=e.query;try{var o=this,i="BING_JSONP_CB_"+Date.now();return Promise.resolve((t=o.endpoint({query:s,jsonp:i}),n=i,r=l("script",null,document.body),r.setAttribute("type","text/javascript"),new Promise((function(e){window[n]=function(t){r.remove(),delete window[n],e(t)},r.setAttribute("src",t)})))).then((function(e){return o.parse({data:e})}))}catch(e){return Promise.reject(e)}},t}(L),_=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).searchUrl="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/find",t}c(t,e);var n=t.prototype;return n.endpoint=function(e){var t=e.query,n="string"==typeof t?{text:t}:t;return n.f="json",this.getUrl(this.searchUrl,n)},n.parse=function(e){return e.data.locations.map((function(e){return{x:e.feature.geometry.x,y:e.feature.geometry.y,label:e.name,bounds:[[e.extent.ymin,e.extent.xmin],[e.extent.ymax,e.extent.xmax]],raw:e}}))},t}(L),P=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).searchUrl="https://maps.googleapis.com/maps/api/geocode/json",t}c(t,e);var n=t.prototype;return n.endpoint=function(e){var t=e.query;return this.getUrl(this.searchUrl,"string"==typeof t?{address:t}:t)},n.parse=function(e){return e.data.results.map((function(e){return{x:e.geometry.location.lng,y:e.geometry.location.lat,label:e.formatted_address,bounds:[[e.geometry.viewport.southwest.lat,e.geometry.viewport.southwest.lng],[e.geometry.viewport.northeast.lat,e.geometry.viewport.northeast.lng]],raw:e}}))},t}(L),j=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).searchUrl="https://geocode.search.hereapi.com/v1/geocode",t}c(t,e);var n=t.prototype;return n.endpoint=function(e){var t=e.query;return this.getUrl(this.searchUrl,"string"==typeof t?{q:t}:t)},n.parse=function(e){return e.data.items.map((function(e){return{x:e.position.lng,y:e.position.lat,label:e.address.label,bounds:null,raw:e}}))},t}(L),R=function(e){function t(t){var n;void 0===t&&(t={});var r="https://nominatim.openstreetmap.org";return(n=e.call(this,t)||this).searchUrl=t.searchUrl||r+"/search",n.reverseUrl=t.reverseUrl||r+"/reverse",n}c(t,e);var n=t.prototype;return n.endpoint=function(e){var t=e.query,n=e.type,r="string"==typeof t?{q:t}:t;switch(r.format="json",n){case f.REVERSE:return this.getUrl(this.reverseUrl,r);default:return this.getUrl(this.searchUrl,r)}},n.parse=function(e){return(Array.isArray(e.data)?e.data:[e.data]).map((function(e){return{x:Number(e.lon),y:Number(e.lat),label:e.display_name,bounds:[[parseFloat(e.boundingbox[0]),parseFloat(e.boundingbox[2])],[parseFloat(e.boundingbox[1]),parseFloat(e.boundingbox[3])]],raw:e}}))},t}(L),A=function(e){function t(t){return e.call(this,a({},t,{searchUrl:"https://locationiq.org/v1/search.php",reverseUrl:"https://locationiq.org/v1/reverse.php"}))||this}return c(t,e),t}(R),U=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).searchUrl="https://api.opencagedata.com/geocode/v1/json",t}c(t,e);var n=t.prototype;return n.endpoint=function(e){var t=e.query,n="string"==typeof t?{q:t}:t;return n.format="json",this.getUrl(this.searchUrl,n)},n.parse=function(e){return e.data.results.map((function(e){return{x:e.geometry.lng,y:e.geometry.lat,label:e.formatted,bounds:[[e.bounds.southwest.lat,e.bounds.southwest.lng],[e.bounds.northeast.lat,e.bounds.northeast.lng]],raw:e}}))},n.search=function(t){try{return Promise.resolve(t.query.length<2?[]:e.prototype.search.call(this,t))}catch(e){return Promise.reject(e)}},t}(L);var q=":host .icon{margin:0 1rem}:host .btn-back a{color:#666;margin-right:0.5rem}:host .search-hpc{display:-ms-flexbox;display:flex}:host .search-btn{-ms-flex-item-align:center;align-self:center}:host .search-form{display:-ms-flexbox;display:flex}:host .search-address-item{padding:1rem;border-bottom:1px solid #ddd;cursor:pointer}:host .search-address-item.active{border-bottom:1px solid green;color:green}";var N=e("onekey_sdk_search",function(){function e(e){var n=this;t(this,e);this.formData={name:"",address:""};this.searchResult=[];this.selectedAddress={};this.provider=new R;this.onSearch=function(e){e.preventDefault();s.setState({search:Object.assign(Object.assign({},n.formData),{selectedItem:n.selectedAddress})});o.push("/search-result")};this.onChange=function(e){return __awaiter(n,void 0,void 0,(function(){var t;var n;return __generator(this,(function(r){switch(r.label){case 0:this.formData=Object.assign(Object.assign({},this.formData),(n={},n[e.target.id]=e.target.value,n));if(!(e.target.id==="address"))return[3,2];return[4,this.provider.search({query:e.target.value})];case 1:t=r.sent();this.searchResult=__spreadArrays(t);r.label=2;case 2:return[2]}}))}))};this.onSelectAddress=function(e){n.selectedAddress=Object.assign({},e)}}e.prototype.render=function(){var e=this;return n(r,null,n("div",{class:"main-block-full main-block--full"},n("div",{class:"search-hpc"},n("onekey-sdk-router-link",{url:"/",class:"btn-back"},n("ion-icon",{name:"arrow-back-outline",size:"large"})),n("form",{onSubmit:this.onSearch,class:"search-form"},n("div",null,n("input",{id:"name",placeholder:"Name, Speciality, Establishment...",onChange:this.onChange}),n("input",{value:this.selectedAddress.label,id:"address",placeholder:"Near me",onChange:this.onChange})),n("button",{class:"icon btn search-btn",type:"submit"},n("ion-icon",{name:"search-outline"}))))),n("div",{class:"main-contain"},n("ul",null,this.searchResult.map((function(t){var r,s;return n("li",{class:"search-address-item "+(((s=(r=e.selectedAddress)===null||r===void 0?void 0:r.raw)===null||s===void 0?void 0:s.place_id)===t.raw.place_id?"active":""),onClick:function(){return e.onSelectAddress(t)}},t.label)})))))};return e}());N.style=q}}}));