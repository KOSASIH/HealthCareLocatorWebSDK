import{r as t,h as n,H as r}from"./index-20b60922.js";import{s as e,r as i}from"./index-d55f2b69.js";import{l as o}from"./leaflet-src-b68b6fd5.js";function s(){return(s=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t}).apply(this,arguments)}function a(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}function u(t,n,r,e){void 0===n&&(n=""),void 0===e&&(e={});var i=document.createElement(t);return n&&(i.className=n),Object.keys(e).forEach((function(t){if("function"==typeof e[t]){var n=0===t.indexOf("on")?t.substr(2).toLowerCase():t;i.addEventListener(n,e[t])}else"html"===t?i.innerHTML=e[t]:"text"===t?i.innerText=e[t]:i.setAttribute(t,e[t])})),r&&r.appendChild(i),i}function c(t){t.preventDefault(),t.stopPropagation()}var h=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.filter(Boolean).join(" ").trim()};function l(t,n){t&&t.classList&&(Array.isArray(n)?n:[n]).forEach((function(n){t.classList.contains(n)||t.classList.add(n)}))}function f(t,n){t&&t.classList&&(Array.isArray(n)?n:[n]).forEach((function(n){t.classList.contains(n)&&t.classList.remove(n)}))}var d,v,p=(function(){var t=function(t){var n=this,r=t.handleSubmit,e=t.searchLabel,i=t.classNames,o=void 0===i?{}:i;this.hasError=!1,this.container=u("div",h("geosearch",o.container)),this.form=u("form",["",o.form].join(" "),this.container,{autocomplete:"none",onClick:c,onDblClick:c,touchStart:c,touchEnd:c}),this.input=u("input",["glass",o.input].join(" "),this.form,{type:"text",placeholder:e||"search",onInput:this.onInput,onKeyUp:function(t){return n.onKeyUp(t)},onKeyPress:function(t){return n.onKeyPress(t)},onFocus:this.onFocus,onBlur:this.onBlur,onClick:function(){n.input.focus(),n.input.dispatchEvent(new Event("focus"))}}),this.handleSubmit=r}.prototype;t.onFocus=function(){l(this.form,"active")},t.onBlur=function(){f(this.form,"active")},t.onSubmit=function(t){try{var n=this;return c(t),f(r=n.container,"error"),l(r,"pending"),Promise.resolve(n.handleSubmit({query:n.input.value})).then((function(){f(n.container,"pending")}))}catch(t){return Promise.reject(t)}var r},t.onInput=function(){this.hasError&&(f(this.container,"error"),this.hasError=!1)},t.onKeyUp=function(t){27===t.keyCode&&(f(this.container,["pending","active"]),this.input.value="",document.body.focus(),document.body.blur())},t.onKeyPress=function(t){13===t.keyCode&&this.onSubmit(t)},t.setQuery=function(t){this.input.value=t}}(),function(){var t=function(t){var n=this,r=t.handleClick,e=t.classNames,i=void 0===e?{}:e;this.selected=-1,this.results=[],this.onClick=function(t){if("function"==typeof n.handleClick){var r=t.target;if(r&&n.container.contains(r)&&r.hasAttribute("data-key")){var e=Number(r.getAttribute("data-key"));n.clear(),n.handleClick({result:n.results[e]})}}},this.handleClick=r,this.container=u("div",h("results",i.container)),this.container.addEventListener("click",this.onClick,!0),this.resultItem=u("div",h(i.item))}.prototype;t.render=function(t){var n=this;void 0===t&&(t=[]),this.clear(),t.forEach((function(t,r){var e=n.resultItem.cloneNode(!0);e.setAttribute("data-key",""+r),e.innerHTML=t.label,n.container.appendChild(e)})),t.length>0&&(l(this.container.parentElement,"open"),l(this.container,"active")),this.results=t},t.select=function(t){return Array.from(this.container.children).forEach((function(n,r){return r===t?l(n,"active"):f(n,"active")})),this.selected=t,this.results[t]},t.count=function(){return this.results?this.results.length:0},t.clear=function(){for(this.selected=-1;this.container.lastChild;)this.container.removeChild(this.container.lastChild);f(this.container.parentElement,"open"),f(this.container,"active")}}(),{position:"topleft",style:"button",showMarker:!0,showPopup:!1,popupFormat:function(t){return""+t.result.label},marker:{icon:o&&o.Icon?new o.Icon.Default:void 0,draggable:!1},maxMarkers:1,maxSuggestions:5,retainZoomLevel:!1,animateZoom:!0,searchLabel:"Enter address",notFoundMessage:"Sorry, that address could not be found.",messageHideDelay:3e3,zoomLevel:18,classNames:{container:"leaflet-bar leaflet-control leaflet-control-geosearch",button:"leaflet-bar-part leaflet-bar-part-single",resetButton:"reset",msgbox:"leaflet-bar message",form:"",input:""},autoComplete:!0,autoCompleteDelay:250,autoClose:!1,keepResult:!1,updateMap:!0});s({},p),s({},p.classNames),(v=d||(d={}))[v.SEARCH=0]="SEARCH",v[v.REVERSE=1]="REVERSE";var m=function(){function t(t){void 0===t&&(t={}),this.options=t}var n=t.prototype;return n.getParamString=function(t){void 0===t&&(t={});var n=s({},this.options.params,{},t);return Object.keys(n).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(n[t])})).join("&")},n.getUrl=function(t,n){return t+"?"+this.getParamString(n)},n.search=function(t){try{var n=this,r=n.endpoint({query:t.query,type:d.SEARCH});return Promise.resolve(fetch(r)).then((function(t){return Promise.resolve(t.json()).then((function(t){return n.parse({data:t})}))}))}catch(t){return Promise.reject(t)}},t}(),b=(function(t){function n(){return t.apply(this,arguments)||this}a(n,t);var r=n.prototype;r.endpoint=function(){return"https://places-dsn.algolia.net/1/places/query"},r.findBestMatchLevelIndex=function(t){var n=t.find((function(t){return"full"===t.matchLevel}))||t.find((function(t){return"partial"===t.matchLevel}));return n?t.indexOf(n):0},r.getLabel=function(t){var n,r,e,i;return[null==(n=t.locale_names)?void 0:n.default[this.findBestMatchLevelIndex(t._highlightResult.locale_names.default)],null==(r=t.city)?void 0:r.default[this.findBestMatchLevelIndex(t._highlightResult.city.default)],t.administrative[this.findBestMatchLevelIndex(t._highlightResult.administrative)],null==(e=t.postcode)?void 0:e[this.findBestMatchLevelIndex(t._highlightResult.postcode)],null==(i=t.country)?void 0:i.default].filter(Boolean).join(", ")},r.parse=function(t){var n=this;return t.data.hits.map((function(t){return{x:t._geoloc.lng,y:t._geoloc.lat,label:n.getLabel(t),bounds:null,raw:t}}))},r.search=function(t){var n=t.query;try{var r=this,e="string"==typeof n?{query:n}:n;return Promise.resolve(fetch(r.endpoint(),{method:"POST",body:JSON.stringify(s({},r.options.params,{},e))})).then((function(t){return Promise.resolve(t.json()).then((function(t){return r.parse({data:t})}))}))}catch(t){return Promise.reject(t)}}}(m),function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://dev.virtualearth.net/REST/v1/Locations",n}a(n,t);var r=n.prototype;r.endpoint=function(t){var n=t.query,r="string"==typeof n?{q:n}:n;return r.jsonp=t.jsonp,this.getUrl(this.searchUrl,r)},r.parse=function(t){return 0===t.data.resourceSets.length?[]:t.data.resourceSets[0].resources.map((function(t){return{x:t.point.coordinates[1],y:t.point.coordinates[0],label:t.address.formattedAddress,bounds:[[t.bbox[0],t.bbox[1]],[t.bbox[2],t.bbox[3]]],raw:t}}))},r.search=function(t){var n,r,e,i=t.query;try{var o=this,s="BING_JSONP_CB_"+Date.now();return Promise.resolve((n=o.endpoint({query:i,jsonp:s}),r=s,e=u("script",null,document.body),e.setAttribute("type","text/javascript"),new Promise((function(t){window[r]=function(n){e.remove(),delete window[r],t(n)},e.setAttribute("src",n)})))).then((function(t){return o.parse({data:t})}))}catch(t){return Promise.reject(t)}}}(m),function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/find",n}a(n,t);var r=n.prototype;r.endpoint=function(t){var n=t.query,r="string"==typeof n?{text:n}:n;return r.f="json",this.getUrl(this.searchUrl,r)},r.parse=function(t){return t.data.locations.map((function(t){return{x:t.feature.geometry.x,y:t.feature.geometry.y,label:t.name,bounds:[[t.extent.ymin,t.extent.xmin],[t.extent.ymax,t.extent.xmax]],raw:t}}))}}(m),function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://maps.googleapis.com/maps/api/geocode/json",n}a(n,t);var r=n.prototype;r.endpoint=function(t){var n=t.query;return this.getUrl(this.searchUrl,"string"==typeof n?{address:n}:n)},r.parse=function(t){return t.data.results.map((function(t){return{x:t.geometry.location.lng,y:t.geometry.location.lat,label:t.formatted_address,bounds:[[t.geometry.viewport.southwest.lat,t.geometry.viewport.southwest.lng],[t.geometry.viewport.northeast.lat,t.geometry.viewport.northeast.lng]],raw:t}}))}}(m),function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://geocode.search.hereapi.com/v1/geocode",n}a(n,t);var r=n.prototype;r.endpoint=function(t){var n=t.query;return this.getUrl(this.searchUrl,"string"==typeof n?{q:n}:n)},r.parse=function(t){return t.data.items.map((function(t){return{x:t.position.lng,y:t.position.lat,label:t.address.label,bounds:null,raw:t}}))}}(m),function(t){function n(n){var r;void 0===n&&(n={});var e="https://nominatim.openstreetmap.org";return(r=t.call(this,n)||this).searchUrl=n.searchUrl||e+"/search",r.reverseUrl=n.reverseUrl||e+"/reverse",r}a(n,t);var r=n.prototype;return r.endpoint=function(t){var n=t.query,r=t.type,e="string"==typeof n?{q:n}:n;switch(e.format="json",r){case d.REVERSE:return this.getUrl(this.reverseUrl,e);default:return this.getUrl(this.searchUrl,e)}},r.parse=function(t){return(Array.isArray(t.data)?t.data:[t.data]).map((function(t){return{x:Number(t.lon),y:Number(t.lat),label:t.display_name,bounds:[[parseFloat(t.boundingbox[0]),parseFloat(t.boundingbox[2])],[parseFloat(t.boundingbox[1]),parseFloat(t.boundingbox[3])]],raw:t}}))},n}(m));(function(t){a((function(n){return t.call(this,s({},n,{searchUrl:"https://locationiq.org/v1/search.php",reverseUrl:"https://locationiq.org/v1/reverse.php"}))||this}),t)})(b),function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://api.opencagedata.com/geocode/v1/json",n}a(n,t);var r=n.prototype;r.endpoint=function(t){var n=t.query,r="string"==typeof n?{q:n}:n;return r.format="json",this.getUrl(this.searchUrl,r)},r.parse=function(t){return t.data.results.map((function(t){return{x:t.geometry.lng,y:t.geometry.lat,label:t.formatted,bounds:[[t.bounds.southwest.lat,t.bounds.southwest.lng],[t.bounds.northeast.lat,t.bounds.northeast.lng]],raw:t}}))},r.search=function(n){try{return Promise.resolve(n.query.length<2?[]:t.prototype.search.call(this,n))}catch(t){return Promise.reject(t)}}}(m);const y=class{constructor(n){t(this,n),this.formData={name:"",address:""},this.searchResult=[],this.selectedAddress={},this.provider=new b,this.onSearch=t=>{t.preventDefault(),e.setState({search:Object.assign(Object.assign({},this.formData),{selectedItem:this.selectedAddress})}),i.push("/search-result")},this.onChange=async t=>{if(this.formData=Object.assign(Object.assign({},this.formData),{[t.target.id]:t.target.value}),"address"===t.target.id){const n=await this.provider.search({query:t.target.value});this.searchResult=[...n]}},this.onSelectAddress=t=>{this.selectedAddress=Object.assign({},t)}}render(){return n(r,null,n("div",{class:"main-block-full main-block--full"},n("div",{class:"search-hpc"},n("onekey-sdk-router-link",{url:"/",class:"btn-back"},n("ion-icon",{name:"arrow-back-outline",size:"large"})),n("form",{onSubmit:this.onSearch,class:"search-form"},n("div",null,n("input",{id:"name",placeholder:"Name, Speciality, Establishment...",onChange:this.onChange}),n("input",{value:this.selectedAddress.label,id:"address",placeholder:"Near me",onChange:this.onChange})),n("button",{class:"icon btn search-btn",type:"submit"},n("ion-icon",{name:"search-outline"}))))),n("div",{class:"main-contain"},n("ul",null,this.searchResult.map((t=>{var r,e;return n("li",{class:"search-address-item "+((null===(e=null===(r=this.selectedAddress)||void 0===r?void 0:r.raw)||void 0===e?void 0:e.place_id)===t.raw.place_id?"active":""),onClick:()=>this.onSelectAddress(t)},t.label)})))))}};y.style=":host .icon{margin:0 1rem}:host .btn-back a{color:#666;margin-right:0.5rem}:host .search-hpc{display:-ms-flexbox;display:flex}:host .search-btn{-ms-flex-item-align:center;align-self:center}:host .search-form{display:-ms-flexbox;display:flex}:host .search-address-item{padding:1rem;border-bottom:1px solid #ddd;cursor:pointer}:host .search-address-item.active{border-bottom:1px solid green;color:green}";export{y as onekey_sdk_search}