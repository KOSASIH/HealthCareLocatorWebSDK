var __awaiter=this&&this.__awaiter||function(e,t,r,n){function s(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function i(e){try{l(n["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):s(e.value).then(a,i)}l((n=n.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,a;return a={next:i(0),throw:i(1),return:i(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function i(e){return function(t){return l([e,t])}}function l(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,s&&(o=a[0]&2?s["return"]:a[0]?s["throw"]||((o=s["return"])&&o.call(s),0):s.next)&&!(o=o.call(s,a[1])).done)return o;if(s=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;s=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(o=r.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(a[0]===6&&r.label<o[1]){r.label=o[1];o=a;break}if(o&&r.label<o[2]){r.label=o[2];r.ops.push(a);break}if(o[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];s=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),s=0,t=0;t<r;t++)for(var o=arguments[t],a=0,i=o.length;a<i;a++,s++)n[s]=o[a];return n};import{r as registerInstance,h as h$1,H as Host}from"./index-20b60922.js";import{s as searchMapStore,r as routerStore}from"./index-d55f2b69.js";import{l as leafletSrc}from"./leaflet-src-b68b6fd5.js";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function s(e,t,r,n){void 0===t&&(t=""),void 0===n&&(n={});var s=document.createElement(e);return t&&(s.className=t),Object.keys(n).forEach((function(e){if("function"==typeof n[e]){var t=0===e.indexOf("on")?e.substr(2).toLowerCase():e;s.addEventListener(t,n[e])}else"html"===e?s.innerHTML=n[e]:"text"===e?s.innerText=n[e]:s.setAttribute(e,n[e])})),r&&r.appendChild(s),s}function a(e){e.preventDefault(),e.stopPropagation()}var u=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter(Boolean).join(" ").trim()};function c(e,t){e&&e.classList&&(Array.isArray(t)?t:[t]).forEach((function(t){e.classList.contains(t)||e.classList.add(t)}))}function l(e,t){e&&e.classList&&(Array.isArray(t)?t:[t]).forEach((function(t){e.classList.contains(t)&&e.classList.remove(t)}))}var h,p=13,f=40,d=38,m=[p,27,f,d,37,39],v=function(){function e(e){var t=this,r=e.handleSubmit,n=e.searchLabel,o=e.classNames,i=void 0===o?{}:o;this.hasError=!1,this.container=s("div",u("geosearch",i.container)),this.form=s("form",["",i.form].join(" "),this.container,{autocomplete:"none",onClick:a,onDblClick:a,touchStart:a,touchEnd:a}),this.input=s("input",["glass",i.input].join(" "),this.form,{type:"text",placeholder:n||"search",onInput:this.onInput,onKeyUp:function(e){return t.onKeyUp(e)},onKeyPress:function(e){return t.onKeyPress(e)},onFocus:this.onFocus,onBlur:this.onBlur,onClick:function(){t.input.focus(),t.input.dispatchEvent(new Event("focus"))}}),this.handleSubmit=r}var t=e.prototype;return t.onFocus=function(){c(this.form,"active")},t.onBlur=function(){l(this.form,"active")},t.onSubmit=function(e){try{var t=this;return a(e),l(r=t.container,"error"),c(r,"pending"),Promise.resolve(t.handleSubmit({query:t.input.value})).then((function(){l(t.container,"pending")}))}catch(e){return Promise.reject(e)}var r},t.onInput=function(){this.hasError&&(l(this.container,"error"),this.hasError=!1)},t.onKeyUp=function(e){27===e.keyCode&&(l(this.container,["pending","active"]),this.input.value="",document.body.focus(),document.body.blur())},t.onKeyPress=function(e){e.keyCode===p&&this.onSubmit(e)},t.setQuery=function(e){this.input.value=e},e}(),y=function(){function e(e){var t=this,r=e.handleClick,n=e.classNames,o=void 0===n?{}:n;this.selected=-1,this.results=[],this.onClick=function(e){if("function"==typeof t.handleClick){var r=e.target;if(r&&t.container.contains(r)&&r.hasAttribute("data-key")){var n=Number(r.getAttribute("data-key"));t.clear(),t.handleClick({result:t.results[n]})}}},this.handleClick=r,this.container=s("div",u("results",o.container)),this.container.addEventListener("click",this.onClick,!0),this.resultItem=s("div",u(o.item))}var t=e.prototype;return t.render=function(e){var t=this;void 0===e&&(e=[]),this.clear(),e.forEach((function(e,r){var n=t.resultItem.cloneNode(!0);n.setAttribute("data-key",""+r),n.innerHTML=e.label,t.container.appendChild(n)})),e.length>0&&(c(this.container.parentElement,"open"),c(this.container,"active")),this.results=e},t.select=function(e){return Array.from(this.container.children).forEach((function(t,r){return r===e?c(t,"active"):l(t,"active")})),this.selected=e,this.results[e]},t.count=function(){return this.results?this.results.length:0},t.clear=function(){for(this.selected=-1;this.container.lastChild;)this.container.removeChild(this.container.lastChild);l(this.container.parentElement,"open"),l(this.container,"active")},e}(),g={position:"topleft",style:"button",showMarker:!0,showPopup:!1,popupFormat:function(e){return""+e.result.label},marker:{icon:leafletSrc&&leafletSrc.Icon?new leafletSrc.Icon.Default:void 0,draggable:!1},maxMarkers:1,maxSuggestions:5,retainZoomLevel:!1,animateZoom:!0,searchLabel:"Enter address",notFoundMessage:"Sorry, that address could not be found.",messageHideDelay:3e3,zoomLevel:18,classNames:{container:"leaflet-bar leaflet-control leaflet-control-geosearch",button:"leaflet-bar-part leaflet-bar-part-single",resetButton:"reset",msgbox:"leaflet-bar message",form:"",input:""},autoComplete:!0,autoCompleteDelay:250,autoClose:!1,keepResult:!1,updateMap:!0},b="Leaflet must be loaded before instantiating the GeoSearch control",E={options:e({},g),classNames:e({},g.classNames),initialize:function(t){var r,n,o,a,i=this;if(!leafletSrc)throw new Error(b);if(!t.provider)throw new Error("Provider is missing from options");this.options=e({},this.options,{},t),this.classNames=e({},this.classNames,{},t.classNames),this.markers=new leafletSrc.FeatureGroup,this.classNames.container+=" leaflet-geosearch-"+this.options.style,this.searchElement=new v({searchLabel:this.options.searchLabel,classNames:{container:this.classNames.container,form:this.classNames.form,input:this.classNames.input},handleSubmit:function(e){return i.onSubmit(e)}}),this.button=s("a",this.classNames.button,this.searchElement.container,{title:this.options.searchLabel,href:"#",onClick:function(e){return i.onClick(e)}}),leafletSrc.DomEvent.disableClickPropagation(this.button),this.resetButton=s("a",this.classNames.resetButton,this.searchElement.form,{text:"Ã—",href:"#",onClick:function(){return i.clearResults(null,!0)}}),leafletSrc.DomEvent.disableClickPropagation(this.resetButton),this.options.autoComplete&&(this.resultList=new y({handleClick:function(e){var t=e.result;i.searchElement.input.value=t.label,i.onSubmit({query:t.label,data:t})}}),this.searchElement.form.appendChild(this.resultList.container),this.searchElement.input.addEventListener("keyup",(r=function(e){return i.autoSearch(e)},void 0===(n=this.options.autoCompleteDelay)&&(n=250),void 0===o&&(o=!1),function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];a&&clearTimeout(a),a=setTimeout((function(){a=null,o||r.apply(void 0,t)}),n),o&&!a&&r.apply(void 0,t)}),!0),this.searchElement.input.addEventListener("keydown",(function(e){return i.selectResult(e)}),!0),this.searchElement.input.addEventListener("keydown",(function(e){return i.clearResults(e,!0)}),!0)),this.searchElement.form.addEventListener("click",(function(e){e.preventDefault()}),!1)},onAdd:function(e){var t=this.options,r=t.showMarker,n=t.style;if(this.map=e,r&&this.markers.addTo(e),"bar"===n){var o=e.getContainer().querySelector(".leaflet-control-container");this.container=s("div","leaflet-control-geosearch leaflet-geosearch-bar"),this.container.appendChild(this.searchElement.form),o.appendChild(this.container)}return leafletSrc.DomEvent.disableClickPropagation(this.searchElement.form),this.searchElement.container},onRemove:function(){var e;return null==(e=this.container)||e.remove(),this},onClick:function(e){e.preventDefault(),e.stopPropagation();var t=this.searchElement,r=t.container,n=t.input;r.classList.contains("active")?(l(r,"active"),this.clearResults()):(c(r,"active"),n.focus())},selectResult:function(e){if(-1!==[p,f,d].indexOf(e.keyCode))if(e.preventDefault(),e.keyCode!==p){var t=this.resultList.count()-1;if(!(t<0)){var r=this.resultList.selected,n=e.keyCode===f?r+1:r-1,s=this.resultList.select(n<0?t:n>t?0:n);this.searchElement.input.value=s.label}}else{var o=this.resultList.select(this.resultList.selected);this.onSubmit({query:this.searchElement.input.value,data:o})}},clearResults:function(e,t){if(void 0===t&&(t=!1),!e||27===e.keyCode){var r=this.options,n=r.autoComplete;!t&&r.keepResult||(this.searchElement.input.value="",this.markers.clearLayers()),n&&this.resultList.clear()}},autoSearch:function(e){try{var t=this;if(m.indexOf(e.keyCode)>-1)return Promise.resolve();var r=e.target.value,n=t.options.provider,s=function(){if(r.length)return Promise.resolve(n.search({query:r})).then((function(e){e=e.slice(0,t.options.maxSuggestions),t.resultList.render(e)}));t.resultList.clear()}();return Promise.resolve(s&&s.then?s.then((function(){})):void 0)}catch(e){return Promise.reject(e)}},onSubmit:function(e){try{var t=this;return Promise.resolve(t.options.provider.search(e)).then((function(r){r&&r.length>0&&t.showResult(r[0],e)}))}catch(e){return Promise.reject(e)}},showResult:function(e,t){var r=this.options,n=r.autoClose,s=r.updateMap,o=this.markers.getLayers();o.length>=this.options.maxMarkers&&this.markers.removeLayer(o[0]);var a=this.addMarker(e,t);s&&this.centerMap(e),this.map.fireEvent("geosearch/showlocation",{location:e,marker:a}),n&&this.closeResults()},closeResults:function(){var e=this.searchElement.container;e.classList.contains("active")&&l(e,"active"),this.clearResults()},addMarker:function(e,t){var r=this,n=this.options,s=n.marker,o=n.showPopup,a=n.popupFormat,i=new leafletSrc.Marker([e.y,e.x],s),l=e.label;return"function"==typeof a&&(l=a({query:t,result:e})),i.bindPopup(l),this.markers.addLayer(i),o&&i.openPopup(),s.draggable&&i.on("dragend",(function(e){r.map.fireEvent("geosearch/marker/dragend",{location:i.getLatLng(),event:e})})),i},centerMap:function(e){var t=this.options,r=t.retainZoomLevel,n=t.animateZoom,s=e.bounds?new leafletSrc.LatLngBounds(e.bounds):new leafletSrc.LatLng(e.y,e.x).toBounds(10),o=s.isValid()?s:this.markers.getBounds();!r&&s.isValid()?this.map.fitBounds(o,{animate:n}):this.map.setView(o.getCenter(),this.getZoom(),{animate:n})},getZoom:function(){var e=this.options,t=e.zoomLevel;return e.retainZoomLevel?this.map.getZoom():t}};!function(e){e[e.SEARCH=0]="SEARCH",e[e.REVERSE=1]="REVERSE"}(h||(h={}));var k=function(){function t(e){void 0===e&&(e={}),this.options=e}var r=t.prototype;return r.getParamString=function(t){void 0===t&&(t={});var r=e({},this.options.params,{},t);return Object.keys(r).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(r[e])})).join("&")},r.getUrl=function(e,t){return e+"?"+this.getParamString(t)},r.search=function(e){try{var t=this,r=t.endpoint({query:e.query,type:h.SEARCH});return Promise.resolve(fetch(r)).then((function(e){return Promise.resolve(e.json()).then((function(e){return t.parse({data:e})}))}))}catch(e){return Promise.reject(e)}},t}(),w=function(t){function r(){return t.apply(this,arguments)||this}n(r,t);var s=r.prototype;return s.endpoint=function(){return"https://places-dsn.algolia.net/1/places/query"},s.findBestMatchLevelIndex=function(e){var t=e.find((function(e){return"full"===e.matchLevel}))||e.find((function(e){return"partial"===e.matchLevel}));return t?e.indexOf(t):0},s.getLabel=function(e){var t,r,n,s;return[null==(t=e.locale_names)?void 0:t.default[this.findBestMatchLevelIndex(e._highlightResult.locale_names.default)],null==(r=e.city)?void 0:r.default[this.findBestMatchLevelIndex(e._highlightResult.city.default)],e.administrative[this.findBestMatchLevelIndex(e._highlightResult.administrative)],null==(n=e.postcode)?void 0:n[this.findBestMatchLevelIndex(e._highlightResult.postcode)],null==(s=e.country)?void 0:s.default].filter(Boolean).join(", ")},s.parse=function(e){var t=this;return e.data.hits.map((function(e){return{x:e._geoloc.lng,y:e._geoloc.lat,label:t.getLabel(e),bounds:null,raw:e}}))},s.search=function(t){var r=t.query;try{var n=this,s="string"==typeof r?{query:r}:r;return Promise.resolve(fetch(n.endpoint(),{method:"POST",body:JSON.stringify(e({},n.options.params,{},s))})).then((function(e){return Promise.resolve(e.json()).then((function(e){return n.parse({data:e})}))}))}catch(t){return Promise.reject(t)}},r}(k),C=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).searchUrl="https://dev.virtualearth.net/REST/v1/Locations",t}n(t,e);var r=t.prototype;return r.endpoint=function(e){var t=e.query,r="string"==typeof t?{q:t}:t;return r.jsonp=e.jsonp,this.getUrl(this.searchUrl,r)},r.parse=function(e){return 0===e.data.resourceSets.length?[]:e.data.resourceSets[0].resources.map((function(e){return{x:e.point.coordinates[1],y:e.point.coordinates[0],label:e.address.formattedAddress,bounds:[[e.bbox[0],e.bbox[1]],[e.bbox[2],e.bbox[3]]],raw:e}}))},r.search=function(e){var t,r,n,o=e.query;try{var a=this,i="BING_JSONP_CB_"+Date.now();return Promise.resolve((t=a.endpoint({query:o,jsonp:i}),r=i,n=s("script",null,document.body),n.setAttribute("type","text/javascript"),new Promise((function(e){window[r]=function(t){n.remove(),delete window[r],e(t)},n.setAttribute("src",t)})))).then((function(e){return a.parse({data:e})}))}catch(e){return Promise.reject(e)}},t}(k),x=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).searchUrl="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/find",t}n(t,e);var r=t.prototype;return r.endpoint=function(e){var t=e.query,r="string"==typeof t?{text:t}:t;return r.f="json",this.getUrl(this.searchUrl,r)},r.parse=function(e){return e.data.locations.map((function(e){return{x:e.feature.geometry.x,y:e.feature.geometry.y,label:e.name,bounds:[[e.extent.ymin,e.extent.xmin],[e.extent.ymax,e.extent.xmax]],raw:e}}))},t}(k),P=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).searchUrl="https://maps.googleapis.com/maps/api/geocode/json",t}n(t,e);var r=t.prototype;return r.endpoint=function(e){var t=e.query;return this.getUrl(this.searchUrl,"string"==typeof t?{address:t}:t)},r.parse=function(e){return e.data.results.map((function(e){return{x:e.geometry.location.lng,y:e.geometry.location.lat,label:e.formatted_address,bounds:[[e.geometry.viewport.southwest.lat,e.geometry.viewport.southwest.lng],[e.geometry.viewport.northeast.lat,e.geometry.viewport.northeast.lng]],raw:e}}))},t}(k),R=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).searchUrl="https://geocode.search.hereapi.com/v1/geocode",t}n(t,e);var r=t.prototype;return r.endpoint=function(e){var t=e.query;return this.getUrl(this.searchUrl,"string"==typeof t?{q:t}:t)},r.parse=function(e){return e.data.items.map((function(e){return{x:e.position.lng,y:e.position.lat,label:e.address.label,bounds:null,raw:e}}))},t}(k),S=function(e){function t(t){var r;void 0===t&&(t={});var n="https://nominatim.openstreetmap.org";return(r=e.call(this,t)||this).searchUrl=t.searchUrl||n+"/search",r.reverseUrl=t.reverseUrl||n+"/reverse",r}n(t,e);var r=t.prototype;return r.endpoint=function(e){var t=e.query,r=e.type,n="string"==typeof t?{q:t}:t;switch(n.format="json",r){case h.REVERSE:return this.getUrl(this.reverseUrl,n);default:return this.getUrl(this.searchUrl,n)}},r.parse=function(e){return(Array.isArray(e.data)?e.data:[e.data]).map((function(e){return{x:Number(e.lon),y:Number(e.lat),label:e.display_name,bounds:[[parseFloat(e.boundingbox[0]),parseFloat(e.boundingbox[2])],[parseFloat(e.boundingbox[1]),parseFloat(e.boundingbox[3])]],raw:e}}))},t}(k),U=function(t){function r(r){return t.call(this,e({},r,{searchUrl:"https://locationiq.org/v1/search.php",reverseUrl:"https://locationiq.org/v1/reverse.php"}))||this}return n(r,t),r}(S),j=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).searchUrl="https://api.opencagedata.com/geocode/v1/json",t}n(t,e);var r=t.prototype;return r.endpoint=function(e){var t=e.query,r="string"==typeof t?{q:t}:t;return r.format="json",this.getUrl(this.searchUrl,r)},r.parse=function(e){return e.data.results.map((function(e){return{x:e.geometry.lng,y:e.geometry.lat,label:e.formatted,bounds:[[e.bounds.southwest.lat,e.bounds.southwest.lng],[e.bounds.northeast.lat,e.bounds.northeast.lng]],raw:e}}))},r.search=function(t){try{return Promise.resolve(t.query.length<2?[]:e.prototype.search.call(this,t))}catch(e){return Promise.reject(e)}},t}(k);var onekeySdkSearchCss=":host .icon{margin:0 1rem}:host .btn-back a{color:#666;margin-right:0.5rem}:host .search-hpc{display:-ms-flexbox;display:flex}:host .search-btn{-ms-flex-item-align:center;align-self:center}:host .search-form{display:-ms-flexbox;display:flex}:host .search-address-item{padding:1rem;border-bottom:1px solid #ddd;cursor:pointer}:host .search-address-item.active{border-bottom:1px solid green;color:green}";var OnekeySdkSearch=function(){function e(e){var t=this;registerInstance(this,e);this.formData={name:"",address:""};this.searchResult=[];this.selectedAddress={};this.provider=new S;this.onSearch=function(e){e.preventDefault();searchMapStore.setState({search:Object.assign(Object.assign({},t.formData),{selectedItem:t.selectedAddress})});routerStore.push("/search-result")};this.onChange=function(e){return __awaiter(t,void 0,void 0,(function(){var t;var r;return __generator(this,(function(n){switch(n.label){case 0:this.formData=Object.assign(Object.assign({},this.formData),(r={},r[e.target.id]=e.target.value,r));if(!(e.target.id==="address"))return[3,2];return[4,this.provider.search({query:e.target.value})];case 1:t=n.sent();this.searchResult=__spreadArrays(t);n.label=2;case 2:return[2]}}))}))};this.onSelectAddress=function(e){t.selectedAddress=Object.assign({},e)}}e.prototype.render=function(){var e=this;return h$1(Host,null,h$1("div",{class:"main-block-full main-block--full"},h$1("div",{class:"search-hpc"},h$1("onekey-sdk-router-link",{url:"/",class:"btn-back"},h$1("ion-icon",{name:"arrow-back-outline",size:"large"})),h$1("form",{onSubmit:this.onSearch,class:"search-form"},h$1("div",null,h$1("input",{id:"name",placeholder:"Name, Speciality, Establishment...",onChange:this.onChange}),h$1("input",{value:this.selectedAddress.label,id:"address",placeholder:"Near me",onChange:this.onChange})),h$1("button",{class:"icon btn search-btn",type:"submit"},h$1("ion-icon",{name:"search-outline"}))))),h$1("div",{class:"main-contain"},h$1("ul",null,this.searchResult.map((function(t){var r,n;return h$1("li",{class:"search-address-item "+(((n=(r=e.selectedAddress)===null||r===void 0?void 0:r.raw)===null||n===void 0?void 0:n.place_id)===t.raw.place_id?"active":""),onClick:function(){return e.onSelectAddress(t)}},t.label)})))))};return e}();OnekeySdkSearch.style=onekeySdkSearchCss;export{OnekeySdkSearch as onekey_sdk_search};